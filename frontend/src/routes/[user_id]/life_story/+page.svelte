<script lang="ts">
  import ProfileHeader from '$lib/components/ProfileHeader.svelte';
  export let data;

  const { isOwner, lifeStory, profileUserName, profileUserIconUrl } = data;

  let editedStory = {
    childhood: lifeStory?.childhood ?? '', 
    studentDays: lifeStory?.studentDays ?? '', 
    now: lifeStory?.now ?? '', 
  };

  const saveLifeStory = () => {
    alert('ä¿å­˜æ©Ÿèƒ½ã¯æœªå®Ÿè£…ã§ã™');
    // TODO: Supabaseã«patchã™ã‚‹å‡¦ç†ã‚’å®Ÿè£…
  };
</script>

<main class="min-h-screen p-6 bg-gray-100 flex justify-center">
  <div class="bg-white rounded-2xl shadow-lg p-6 w-full max-w-2xl space-y-8 text-left">

    <ProfileHeader userName={profileUserName} iconUrl={profileUserIconUrl} subtitle="ğŸ“œ è‡ªåˆ†å²" />

    <!-- childhood -->
    <section>
      <h2 class="text-xl text-gray-600 font-semibold mb-2">ğŸ‘¶ å­ã©ã‚‚æ™‚ä»£</h2>
      {#if isOwner}
        <textarea
          bind:value={editedStory.childhood}
          rows="4"
          placeholder="æ³£ãè™«ã§ã—ãŸã€‚"
          class="w-full p-3 border border-gray-300 rounded-md text-gray-700 focus:outline-none focus:ring-2 focus:ring-orange-400"
        ></textarea>
      {:else}
        <p class="whitespace-pre-line text-gray-700">{lifeStory?.childhood || 'æº–å‚™ä¸­'}</p>
      {/if}
    </section>

    <!-- studentDays -->
    <section>
      <h2 class="text-xl text-gray-600 font-semibold mb-2">ğŸ“ å­¦ç”Ÿæ™‚ä»£</h2>
      {#if isOwner}
        <textarea
          bind:value={editedStory.studentDays}
          rows="4"
          placeholder="å‹‰å¼·ã›ãšã«é‡çƒã°ã‹ã‚Šã—ã¦ã¾ã—ãŸã€‚"
          class="w-full p-3 border border-gray-300 rounded-md text-gray-700 focus:outline-none focus:ring-2 focus:ring-orange-400"
        ></textarea>
      {:else}
        <p class="whitespace-pre-line text-gray-700">{lifeStory?.studentDays || 'æº–å‚™ä¸­'}</p>
      {/if}
    </section>

    <!-- now -->
    <section>
      <h2 class="text-xl text-gray-600 font-semibold mb-2">ğŸŒ± ä»Šãƒ»ã“ã‚Œã‹ã‚‰</h2>
      {#if isOwner}
        <textarea
          bind:value={editedStory.now}
          rows="4"
          placeholder="èª­æ›¸ãŒå¥½ãã«ãªã‚Šã¾ã—ãŸã€‚"
          class="w-full p-3 border border-gray-300 rounded-md text-gray-700 focus:outline-none focus:ring-2 focus:ring-orange-400"
        ></textarea>
      {:else}
        <p class="whitespace-pre-line text-gray-700">{lifeStory?.now || 'æº–å‚™ä¸­'}</p>
      {/if}
    </section>

    {#if isOwner}
      <div class="text-right pt-4">
        <button
          on:click={saveLifeStory}
          class="bg-orange-400 text-white px-8 py-3 rounded-full shadow-md hover:bg-orange-300 transition font-bold"
        >
          ä¿å­˜
        </button>
      </div>
    {/if}
  </div>
</main>